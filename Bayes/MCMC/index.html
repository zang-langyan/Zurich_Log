<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/Zurich_Log/libs/katex/katex.min.css"> <link rel=stylesheet  href="/Zurich_Log/libs/highlight/github.min.css"> <link rel=stylesheet  href="/Zurich_Log/css/jtd.css"> <link rel=icon  href="/Zurich_Log/assets/infra/logoF_square.gif"> <title>苏黎世学习日志</title> <script src="/Zurich_Log/libs/lunr/lunr.min.js"></script> <script src="/Zurich_Log/libs/lunr/lunr_index.js"></script> <script src="/Zurich_Log/libs/lunr/lunrclient.min.js"></script> <div class=page-wrap > <div class=side-bar > <div class=header > <a href="/Zurich_Log/" class=title  style="color: rgb(255, 165, 127); font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;"> 苏黎世学习日志 <!-- <img style="height:60px;" src="/Zurich_Log/assets/infra/franklin.svg" alt=franklin  /> <style> @media (max-width: 31.25rem){ .side-bar .show-menu {height:30px;} } @media (max-width: 50rem) { .side-bar .header .title {padding-top:0; padding-bottom: 0;} .header .title img {height:60px; max-width: 100px !important;} } @media (min-width: 66.5rem){ .header .title img {max-width: 140px !important;} } </style> --> </a> </div> <label for=show-menu  class=show-menu >MENU</label> <input type=checkbox  id=show-menu  role=button > <div class=menu  id=side-menu > <ul class=menu-list > <li class="menu-list-item "><a href="/Zurich_Log/" class=menu-list-link >• Home</a> <li class="menu-list-parent "><a href="/Zurich_Log/Optim/" class=menu-list-link >• Mathematical Optimization</a> <ul class="menu-list-child-list "> <li class="menu-list-item "><a href="/Zurich_Log/Optim/" class=menu-list-link >Introduction to Mathematical Optimization</a> <li class="menu-list-item "><a href="/Zurich_Log/Optim/linesearch/" class=menu-list-link >Line Search Descent Methods</a> </ul> <li class="menu-list-parent active"><a href="/Zurich_Log/Bayes/" class=menu-list-link >• Bayesian Analysis</a> <ul class="menu-list-child-list "> <li class="menu-list-item "><a href="/Zurich_Log/Bayes/" class=menu-list-link >Bayes' Rule</a> <li class="menu-list-item active"><a href="/Zurich_Log/Bayes/MCMC/" class=menu-list-link >Markov Chain Monte Carlo</a> </ul> <li class="menu-list-parent "><a href="/Zurich_Log/Deeplearning/" class=menu-list-link >• Deep Learning</a> <!-- <ul class="menu-list-child-list "> <li class="menu-list-item {{ispage styling/templates}}active{{end}}"><a href="/Zurich_Log/styling/templates/" class=menu-list-link >Templates</a> <li class="menu-list-item {{ispage styling/classes}}active{{end}}"><a href="/Zurich_Log/styling/classes/" class=menu-list-link >Classes</a> </ul> --> </ul> <!-- <form id=lunrSearchForm  name=lunrSearchForm > <input class=search-input  name=q  placeholder="Enter search term" type=text > <input type=submit  value=Search  formaction="/Zurich_Log/search/index.html"> </form> --> </div> <!-- <div class=footer > <a href="/Zurich_Log/faq/why-o-why/"><img style="width:40%;padding-left:10px;margin-bottom:15px;" src="/Zurich_Log/assets/infra/logoF2.svg" alt="Franklin Logo" /></a> </div> --> </div> <div class=main-content-wrap > <div class=main-content  id=focus  tabindex=-1  style="outline:0;"> <div class=main-header > <a name=pagetop ></a> <span style="width:30px; text-align: center;color:lightgray;">|</span> <a id=github  href="https://github.com/7lang2yan">GitHub Repository</a> </div> <div class=franklin-content ><h1 id="马尔可夫链蒙特卡洛方法_markov_chain_monte_carlo_methods"><a href="#马尔可夫链蒙特卡洛方法_markov_chain_monte_carlo_methods" class=header-anchor >马尔可夫链蒙特卡洛方法 Markov Chain Monte Carlo Methods</a></h1> <div class=franklin-toc ><ol><li><a href="#metropolis_algorithm">Metropolis Algorithm</a><ol><li><a href="#juliapythonmatlabr_codes">Julia/Python/Matlab/R Codes</a><li><a href="#examples">Examples</a></ol></ol></div> <div class=blank ></div> <h2 id=metropolis_algorithm ><a href="#metropolis_algorithm" class=header-anchor >Metropolis Algorithm</a></h2> <p>Suppose a random variable <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> follows a probability density &#40;or mass&#41; function <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>. Here, it is <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span> follows the posterior distribution function <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mi mathvariant=normal >∣</mi><mi>D</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">p(\theta|D)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mclose >)</span></span></span></span> - step 0: Initialize the random variable <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mrow><mi>c</mi><mi>u</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\theta_{cur}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> &#40;posterior case&#41;. &#40;For the other cases, it could be any random variable, e.g. r.v. <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>&#41;</p> <div class=algorithm ><div class=title >Metropolis Algorithm:</div> <div class=content ><ul> <li><p>step 1: Generate a random proposed jump <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >Δ</mi><mi>θ</mi><mo>∼</mo><mi>N</mi><mo stretchy=false >(</mo><mi>μ</mi><mo>=</mo><mn>0</mn><mo separator=true >,</mo><mi>σ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">\Delta \theta \sim N(\mu = 0, \sigma)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6944em;"></span><span class=mord >Δ</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class=mopen >(</span><span class="mord mathnormal">μ</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >0</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=mclose >)</span></span></span></span> &#40;Note: 1. it could be other kind suitable distributions. 2. for the multivariate distributions, generate the jump from a multivariate distribution, e.g. <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >Δ</mi><mrow><mi mathvariant=bold >θ</mi><mo>∼</mo><mi mathvariant=bold >N</mi><mo stretchy=false >(</mo><mrow><mi mathvariant=bold >μ</mi><mo>=</mo><mn mathvariant=bold >0</mn><mo separator=true >,</mo><mi mathvariant=bold >Σ</mi><mo stretchy=false >)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\Delta \bf{\theta} \sim N(\bf{\mu} = 0, \Sigma)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >Δ</span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2778em;"></span><span class="mord mathbf">N</span><span class=mopen >(</span><span class=mord ><span class=mord ><span class="mord mathnormal">μ</span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span><span class="mord mathbf">0</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathbf">Σ</span><span class=mclose >)</span></span></span></span></span></span>&#41;. <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mrow><mi>p</mi><mi>r</mi><mi>o</mi></mrow></msub><mo>=</mo><msub><mi>θ</mi><mrow><mi>c</mi><mi>u</mi><mi>r</mi></mrow></msub><mo>+</mo><mi mathvariant=normal >Δ</mi><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta_{pro} = \theta_{cur} + \Delta \theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.9805em;vertical-align:-0.2861em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">ro</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6944em;"></span><span class=mord >Δ</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span> </p> <li><p>step 2: Computing the moving probability for the random walk: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>m</mi><mi>o</mi><mi>v</mi><mi>e</mi></mrow></msub><mo>=</mo><mi>min</mi><mo>⁡</mo><mo stretchy=false >(</mo><mn>1</mn><mo separator=true >,</mo><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mrow><mi>p</mi><mi>r</mi><mi>o</mi></mrow></msub><mo stretchy=false >)</mo></mrow><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mrow><mi>c</mi><mi>u</mi><mi>r</mi></mrow></msub><mo stretchy=false >)</mo></mrow></mfrac></mstyle><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">p_{move} = \min (1, \dfrac{P(\theta_{pro})}{P(\theta_{cur})})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:2.363em;vertical-align:-0.936em;"></span><span class=mop >min</span><span class=mopen >(</span><span class=mord >1</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">ro</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose >)</span></span></span></span>. For the posterior distribution, since it is proportional to the product of prior and likelihood <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mi mathvariant=normal >∣</mi><mi>D</mi><mo stretchy=false >)</mo><mo>∝</mo><mi>p</mi><mo stretchy=false >(</mo><mi>D</mi><mi mathvariant=normal >∣</mi><mi>θ</mi><mo stretchy=false >)</mo><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">p(\theta|D) \propto p(D|\theta)p(\theta)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span>, we have <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>m</mi><mi>o</mi><mi>v</mi><mi>e</mi></mrow></msub><mo>=</mo><mi>min</mi><mo>⁡</mo><mo stretchy=false >(</mo><mn>1</mn><mo separator=true >,</mo><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>D</mi><mi mathvariant=normal >∣</mi><msub><mi>θ</mi><mrow><mi>p</mi><mi>r</mi><mi>o</mi></mrow></msub><mo stretchy=false >)</mo><mi>p</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mrow><mi>p</mi><mi>r</mi><mi>o</mi></mrow></msub><mo stretchy=false >)</mo></mrow><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>D</mi><mi mathvariant=normal >∣</mi><msub><mi>θ</mi><mrow><mi>c</mi><mi>u</mi><mi>r</mi></mrow></msub><mo stretchy=false >)</mo><mi>p</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mrow><mi>c</mi><mi>u</mi><mi>r</mi></mrow></msub><mo stretchy=false >)</mo></mrow></mfrac></mstyle><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">p_{move} = \min (1, \dfrac{p(D|\theta_{pro})p(\theta_{pro})}{p(D|\theta_{cur})p(\theta_{cur})})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:2.363em;vertical-align:-0.936em;"></span><span class=mop >min</span><span class=mopen >(</span><span class=mord >1</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mord >∣</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mord >∣</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">ro</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">ro</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose >)</span></span></span></span>. &#40;Note: if the proposed r.v. <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>h</mi><mi>e</mi><mi>t</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span></span></span></span> is outside of its acceptable span, then we set <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>m</mi><mi>o</mi><mi>v</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{move}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0</span></span></span></span>&#41; </p> <li><p>step 3: Check if the random walk jump is accepted: generate a random number from <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo stretchy=false >(</mo><mn>0</mn><mo separator=true >,</mo><mn>1</mn><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">U(0,1)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class=mopen >(</span><span class=mord >0</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord >1</span><span class=mclose >)</span></span></span></span> uniform distribution. If it is less than <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>m</mi><mi>o</mi><mi>v</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{move}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, then we accept the jump, otherwise, we stay. </p> <li><p>step 4: Repeating step 1 to step 3, until the random walks from above generate a markov chain which is representative of our target distribution &#40;posterior distribution&#41;</p> </ul></div></div> <p>Check Kruschke&#39;s book &#40;&quot;<a href="https://sites.google.com/site/doingbayesiandataanalysis/"><strong>Doing Bayesian Data Analysis</strong></a>&quot;&#41; for the explanation of MCMC representativeness &#40;7.5.1&#41;, accuracy &#40;7.5.2&#41; and efficiency &#40;7.5.3&#41;</p> <h3 id=juliapythonmatlabr_codes ><a href="#juliapythonmatlabr_codes" class=header-anchor >Julia/Python/Matlab/R Codes</a></h3> <p>For python/julia/matlab/r codes, check my <a href="https://github.com/7lang2yan/Markov-Chain-Monte-Carlo-MCMC.git">Github repository</a>. Full documentation can be found in each file.</p> <h3 id=examples ><a href="#examples" class=header-anchor >Examples</a></h3> <div class=warning ><div class=title >⚠ Warning&#33;</div> <div class=content >You must download the codes from the above repository to run the following examples&#33;</div></div> <h4 id=python ><a href="#python" class=header-anchor >Python</a></h4> <pre><code class="python hljs"><span class=hljs-meta >&gt;&gt;&gt; </span><span class=hljs-keyword >import</span> metropolis
<span class=hljs-meta >&gt;&gt;&gt; </span><span class=hljs-keyword >from</span> scipy.special <span class=hljs-keyword >import</span> beta
<span class=hljs-meta >&gt;&gt;&gt; </span>density = <span class=hljs-keyword >lambda</span> x: x**<span class=hljs-number >14</span> * (<span class=hljs-number >1</span>-x)**<span class=hljs-number >6</span> / beta(<span class=hljs-number >15</span>,<span class=hljs-number >7</span>) <span class=hljs-comment ># Beta(15,7) distribution density function</span>
<span class=hljs-meta >&gt;&gt;&gt; </span>d = metropolis.MCMC(density, space = [<span class=hljs-number >0</span>,<span class=hljs-number >1</span>], burnin = <span class=hljs-number >5</span>, seed = <span class=hljs-number >72</span>)
<span class=hljs-meta >&gt;&gt;&gt; </span>result = d.metropolis(chain = <span class=hljs-number >50</span>, theta_init = <span class=hljs-number >0.1</span>)
<span class=hljs-meta >&gt;&gt;&gt; </span>result
[<span class=hljs-number >0.8176960093922774</span>, <span class=hljs-number >0.6965658096789994</span>, <span class=hljs-number >0.7918980615882665</span>, <span class=hljs-number >0.7742394795862185</span>, <span class=hljs-number >0.7742394795862185</span>, <span class=hljs-number >0.6215414421599866</span>, <span class=hljs-number >0.6215414421599866</span>, <span class=hljs-number >0.6468248283946754</span>, <span class=hljs-number >0.7523307146724492</span>, <span class=hljs-number >0.7523307146724492</span>, <span class=hljs-number >0.7680822171469903</span>, <span class=hljs-number >0.6717376155310788</span>, <span class=hljs-number >0.6717376155310788</span>, <span class=hljs-number >0.8189878864825765</span>, <span class=hljs-number >0.7533257832372013</span>, <span class=hljs-number >0.7648206889254298</span>, <span class=hljs-number >0.7648206889254298</span>, <span class=hljs-number >0.7648206889254298</span>, <span class=hljs-number >0.7648206889254298</span>, <span class=hljs-number >0.7648206889254298</span>, <span class=hljs-number >0.7967947965010628</span>, <span class=hljs-number >0.707139903476412</span>, <span class=hljs-number >0.707139903476412</span>, <span class=hljs-number >0.707139903476412</span>, <span class=hljs-number >0.707139903476412</span>, <span class=hljs-number >0.7949590848197712</span>, <span class=hljs-number >0.48018105229278457</span>, <span class=hljs-number >0.48018105229278457</span>, <span class=hljs-number >0.6163978253871556</span>, <span class=hljs-number >0.6163978253871556</span>, <span class=hljs-number >0.6163978253871556</span>, <span class=hljs-number >0.6241841537823003</span>, <span class=hljs-number >0.6241841537823003</span>, <span class=hljs-number >0.6241841537823003</span>, <span class=hljs-number >0.6241841537823003</span>, <span class=hljs-number >0.6922332333961135</span>, <span class=hljs-number >0.8204027203103916</span>, <span class=hljs-number >0.7521267229207833</span>, <span class=hljs-number >0.7521267229207833</span>, <span class=hljs-number >0.808566620237602</span>, <span class=hljs-number >0.808566620237602</span>, <span class=hljs-number >0.6460288022318678</span>, <span class=hljs-number >0.5452360032045938</span>, <span class=hljs-number >0.5452360032045938</span>, <span class=hljs-number >0.5934357613729606</span>]</code></pre> <h4 id=julia ><a href="#julia" class=header-anchor >Julia</a></h4> <pre><code class="julia-repl hljs"><span class="hljs-meta prompt_">julia&gt;</span><span class=language-julia > p(θ) = Distributions.pdf(Beta(<span class=hljs-number >15</span>,<span class=hljs-number >7</span>),θ) <span class=hljs-comment ># define a density function</span>
</span>
<span class="hljs-meta prompt_">julia&gt;</span><span class=language-julia > metropolis(p, <span class=hljs-number >5000</span>, <span class=hljs-number >0.5</span>; jump = Normal(<span class=hljs-number >0</span>,<span class=hljs-number >0.2</span>), space_min = <span class=hljs-number >0</span>, space_max = <span class=hljs-number >1</span>, burnin = <span class=hljs-number >1000</span>, rng = <span class=hljs-number >42</span>)
</span>4000-element Vector{Float64}:
 0.7254870615709366
 0.5374079418869023
 0.5374079418869023
 0.5161750364065404
 0.7377560837277216
 0.7377560837277216
 0.8127557482035582
 ⋮
 0.7166820320569407
 0.7166820320569407
 0.7166820320569407
 0.7166820320569407
 0.7166820320569407
 0.7586353644413187

<span class="hljs-meta prompt_">julia&gt;</span><span class=language-julia > <span class=hljs-meta >@time</span> metropolis(θ -&gt; Distributions.pdf(Beta(<span class=hljs-number >15</span>,<span class=hljs-number >7</span>),θ), <span class=hljs-number >10000</span>, <span class=hljs-number >0.5</span>; jump = Normal(<span class=hljs-number >0</span>,<span class=hljs-number >0.5</span>), space_min = <span class=hljs-number >0</span>, space_max = <span class=hljs-number >1</span>, burnin = <span class=hljs-number >1000</span>, rng = <span class=hljs-literal >nothing</span>)
</span>0.061715 seconds (103.38 k allocations: 3.814 MiB, 88.90% compilation time)
9000-element Vector{Float64}:
 0.6057362032299476
 0.6057362032299476
 0.6057362032299476
 0.6057362032299476
 0.6057362032299476
 0.6057362032299476
 0.6057362032299476
 ⋮
 0.4516105573548591
 0.4516105573548591
 0.4516105573548591
 0.5014099540247418
 0.6720304713998495
 0.6720304713998495</code></pre> <h4 id=matlab ><a href="#matlab" class=header-anchor >Matlab</a></h4> <pre><code class="matlab hljs">pd = makedist(<span class=hljs-string >&#x27;Weibull&#x27;</span>,<span class=hljs-string >&#x27;A&#x27;</span>,<span class=hljs-number >5</span>,<span class=hljs-string >&#x27;B&#x27;</span>,<span class=hljs-number >2</span>)
chain = metropolis(@(x) pdf(pd,x),<span class=hljs-number >5000</span>,<span class=hljs-number >0.8</span>,makedist(<span class=hljs-string >&#x27;Normal&#x27;</span>,<span class=hljs-string >&#x27;mu&#x27;</span>,<span class=hljs-number >0</span>,<span class=hljs-string >&#x27;sigma&#x27;</span>,<span class=hljs-number >0.9</span>),[<span class=hljs-number >0</span>,Inf],<span class=hljs-number >1000</span>,<span class=hljs-string >&#x27;shuffle&#x27;</span>);</code></pre> <h4 id=r ><a href="#r" class=header-anchor >R</a></h4> <pre><code class="r hljs"><span class=hljs-comment ># Example</span>
<span class=hljs-comment ># posterior function </span>
<span class=hljs-comment ># prior Beta(a = 1, b = 1)</span>
<span class=hljs-comment ># likelihood Bernoulli: N = 20, z = 14</span>
posterior <span class=hljs-operator >&lt;-</span> <span class=hljs-keyword >function</span><span class=hljs-punctuation >(</span>theta<span class=hljs-punctuation >,</span> a<span class=hljs-punctuation >,</span> b<span class=hljs-punctuation >,</span> N<span class=hljs-punctuation >,</span> z<span class=hljs-punctuation >)</span> <span class=hljs-punctuation >{</span>
  dbeta<span class=hljs-punctuation >(</span>theta<span class=hljs-punctuation >,</span> z <span class=hljs-operator >+</span> a<span class=hljs-punctuation >,</span> N <span class=hljs-operator >-</span> z <span class=hljs-operator >+</span> b<span class=hljs-punctuation >)</span>
<span class=hljs-punctuation >}</span>
a <span class=hljs-operator >=</span> <span class=hljs-number >1</span>
b <span class=hljs-operator >=</span> <span class=hljs-number >1</span>
N <span class=hljs-operator >=</span> <span class=hljs-number >20</span> 
z <span class=hljs-operator >=</span> <span class=hljs-number >14</span>
posterior_func <span class=hljs-operator >&lt;-</span> <span class=hljs-keyword >function</span><span class=hljs-punctuation >(</span>theta<span class=hljs-punctuation >)</span> posterior<span class=hljs-punctuation >(</span>theta<span class=hljs-punctuation >,</span> a<span class=hljs-punctuation >,</span> b<span class=hljs-punctuation >,</span> N<span class=hljs-punctuation >,</span> z<span class=hljs-punctuation >)</span>

dposterior1 <span class=hljs-operator >&lt;-</span> metropolis<span class=hljs-punctuation >(</span>chain <span class=hljs-operator >=</span> <span class=hljs-number >5000</span><span class=hljs-punctuation >,</span> theta_cur <span class=hljs-operator >=</span> <span class=hljs-number >0.1</span><span class=hljs-punctuation >,</span> dfunc <span class=hljs-operator >=</span> posterior_func<span class=hljs-punctuation >,</span> space_min <span class=hljs-operator >=</span> <span class=hljs-number >0</span><span class=hljs-punctuation >,</span> space_max <span class=hljs-operator >=</span> <span class=hljs-number >1</span><span class=hljs-punctuation >,</span> burnin <span class=hljs-operator >=</span> <span class=hljs-number >2500</span><span class=hljs-punctuation >)</span>
dposterior2 <span class=hljs-operator >&lt;-</span> metropolis<span class=hljs-punctuation >(</span>chain <span class=hljs-operator >=</span> <span class=hljs-number >5000</span><span class=hljs-punctuation >,</span> theta_cur <span class=hljs-operator >=</span> <span class=hljs-number >0.9</span><span class=hljs-punctuation >,</span> dfunc <span class=hljs-operator >=</span> posterior_func<span class=hljs-punctuation >,</span> space_min <span class=hljs-operator >=</span> <span class=hljs-number >0</span><span class=hljs-punctuation >,</span> space_max <span class=hljs-operator >=</span> <span class=hljs-number >1</span><span class=hljs-punctuation >,</span> burnin <span class=hljs-operator >=</span> <span class=hljs-number >2500</span><span class=hljs-punctuation >)</span>
dposterior3 <span class=hljs-operator >&lt;-</span> metropolis<span class=hljs-punctuation >(</span>chain <span class=hljs-operator >=</span> <span class=hljs-number >5000</span><span class=hljs-punctuation >,</span> theta_cur <span class=hljs-operator >=</span> <span class=hljs-number >0.5</span><span class=hljs-punctuation >,</span> dfunc <span class=hljs-operator >=</span> posterior_func<span class=hljs-punctuation >,</span> space_min <span class=hljs-operator >=</span> <span class=hljs-number >0</span><span class=hljs-punctuation >,</span> space_max <span class=hljs-operator >=</span> <span class=hljs-number >1</span><span class=hljs-punctuation >,</span> burnin <span class=hljs-operator >=</span> <span class=hljs-number >2500</span><span class=hljs-punctuation >)</span></code></pre> <div class=page-foot > <div class=copyright > <a id=github  href="/Zurich_Log//github.com/7lang2yan">&copy; Langyan</a>. Last modified: April 15, 2022. </div> </div> </div> </div> </div> </div> <!-- end of class page-wrap--> <script src="/Zurich_Log/libs/highlight/highlight.min.js"></script>